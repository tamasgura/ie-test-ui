var ImageEditor=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=n(10),i=n(11),s=n(12),a=n(13),u=n(14),c=n(1),l=function(e){return e.width/e.height},v=function(e,t){return t/(e/100)},f=function(e,t){return e/100*t};var d,h,g=(h=function(){return{centerImage:function(e,t){return r.calculateCenteredImagePosition(e,t)},convertImage:i.convertImageType,createImage:function(e){return new c.ImageObj(e)},createCanvas:function(e,t){return new c.CanvasObj(null,e,t)},drawImage:function(e,t,n){return s.drawImg(e,t,n)},getAspectRatio:l,numberToPct:v,pctToNumber:f,getUpdateResources:function(t,n){return u.createUpdateResources(e.el,t,n)},init:function(t){e=t},resizeImage:function(t,n){return void 0===n&&(n={width:e.width,height:e.height}),o.resizeImg(t,n)},operations:a.operationsService};var e},{getInstance:function(){return d||(d=h()),d}});t.default=g.getInstance()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=function(){return function(e,t,n){var r=this;null===e?(this.el=document.createElement("canvas"),this.el.width=this.width=t,this.el.height=this.height=n):(this.el=e,this.width=e.width,this.height=e.height),this.ctx=this.el.getContext("2d"),this.clear=function(){return r.ctx.clearRect(0,0,r.el.width,r.el.height)}}}();t.CanvasObj=o;var i=function(){return function(e){var t=this,n=new Image;n.crossOrigin="Anonymus",this.data=null,this.view={el:null,data:null,pos:{}},this.init=function(){return new Promise(function(o,i){n.onload=function(){t.el=n,t.width=t.el.width=n.width,t.height=t.el.height=n.height,t.view.data=t.data=r.default.convertImage.toData(n),o(t)},n.onerror=i,t.src=e,n.src=e})}}}();t.ImageObj=i;var s=function(){return function(e,t){this.name=e,this.value=t,this.name=e,this.value=t}}();t.Operation=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Brightness="brightness",e.Contrast="contrast",e.Flip="flip",e.Rotate="rotate",e.Crop="crop",e.Resize="resize"}(t.OpTypes||(t.OpTypes={})),function(e){e.OnCropFinished="onCropFinished",e.OnComposeFinished="onComposeFinished"}(t.EventTypes||(t.EventTypes={})),function(e){e.Pixels="pixels",e.Percentages="percentages"}(t.SelectBoxTypes||(t.SelectBoxTypes={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),o=n(19),i=n(5);t.default={cropper:r.default,effects:o.default,transform:i.default}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(0),s=n(2),a=n(18);var u,c,l={canvas:null,image:null,imageData:null,mode:a.Mode.Default,initialCoords:{sx:0,sy:0,ex:0,ey:0},currentCoords:null,dragMoveRefPoint:null,resizeCursorPosition:null},v={init:function(e,t){(o=r({},l)).canvas=e,o.image=t},initSelect:function(e){void 0===e&&(e=o.canvas),o.canvas=e,o.canvas.el.addEventListener(a.MouseEvents.Mousedown,f.selectStart),o.currentCoords=r({},o.initialCoords),o.imageData=e.ctx.getImageData(0,0,+e.width,+e.height),e.el.addEventListener(a.MouseEvents.Mousemove,f.cursor),v.setCursorStyle("crosshair")},setDragMoveRefPoint:function(e){o.dragMoveRefPoint=null!==e?{x:e.x,y:e.y}:null},adjustCoordsToFit:function(e){if(null!==e){var t=v.getImageArea(),n=v.pointIsInsideArea(e,t);return"number"==typeof n.x&&(e.x-=n.x),"number"==typeof n.y&&(e.y-=n.y),e}},setCoords:function(e,t){8===e?a.cornerMap[e].forEach(function(e){var n=e.charAt(1);"x"!==n&&"y"!==n||(o.currentCoords[e]-=t[n])}):a.cornerMap[e].forEach(function(e){var n=e.charAt(1);"x"!==n&&"y"!==n||(o.currentCoords[e]=t[n])})},pointIsInsideArea:function(e,t){var n,r;return e.x>t.sx&&e.x<t.ex?n=!0:e.x<t.sx?n=e.x-t.sx:e.x>t.ex&&(n=e.x-t.ex),e.y>t.sy&&e.y<t.ey?r=!0:e.y<t.sy?r=e.y-t.sy:e.y>t.ey&&(r=e.y-t.ey),{x:n,y:r}},calculateCoords:function(e,t){if(8===e){var n={x:o.dragMoveRefPoint.x-t.x,y:o.dragMoveRefPoint.y-t.y},r={x:o.currentCoords.sx-n.x,y:o.currentCoords.sy-n.y},i={x:o.currentCoords.ex-n.x,y:o.currentCoords.ey-n.y},s=v.getImageArea(),a=v.pointIsInsideArea(r,s),u=v.pointIsInsideArea(i,s);return"number"!=typeof a.x&&"number"!=typeof u.x||(n.x=0),"number"!=typeof a.y&&"number"!=typeof u.y||(n.y=0),v.setDragMoveRefPoint(t),v.setCoords(e,n),!0}return t=v.adjustCoordsToFit(t),v.setCoords(e,t),!0},setCursorStyle:function(e){if(null!==e)if("string"!=typeof e){var t=void 0===a.cursorStyleValues[e]?a.Mode.Default:a.cursorStyleValues[e];o.canvas.el.style.cursor!==t&&(o.canvas.el.style.cursor=t,o.mode===a.Mode.Default&&(o.resizeCursorPosition=e))}else o.canvas.el.style.cursor=e},getSelectedArea:function(e){if(null!==o.currentCoords){var t=o.currentCoords,n=t.sx,r=t.sy,a=t.ex,u=t.ey,c=void 0,l=void 0,v=void 0,f=void 0;n<a?(c=n,v=a):(c=a,v=n),r<u?(l=r,f=u):(l=u,f=r);var d=Math.abs(c-v),h=Math.abs(l-f),g={startX:c,startY:l,width:d,height:h};if(e===s.SelectBoxTypes.Pixels)return g;var p={startX:i.default.numberToPct(o.canvas.width,c),startY:i.default.numberToPct(o.canvas.height,l),width:i.default.numberToPct(o.canvas.width,d),height:i.default.numberToPct(o.canvas.height,h)};if(e===s.SelectBoxTypes.Percentages)return p}},crop:function(e,t){var n;if(void 0===e&&(e=o.image.view.el),void 0===t){var r={x:(o.canvas.el.width-e.width)/2,y:(o.canvas.el.height-e.height)/2};(n=v.getSelectedArea(s.SelectBoxTypes.Pixels)).startX-=r.x,n.startY-=r.y,t={startX:i.default.numberToPct(e.width,n.startX),startY:i.default.numberToPct(e.height,n.startY),width:i.default.numberToPct(e.width,n.width),height:i.default.numberToPct(e.height,n.height)}}else n={startX:i.default.pctToNumber(e.width,t.startX),startY:i.default.pctToNumber(e.height,t.startY),width:i.default.pctToNumber(e.width,t.width),height:i.default.pctToNumber(e.height,t.height)};if(0!==n.width||0!==n.height){var a=i.default.createCanvas(e.width,e.height);a.ctx.drawImage(e,0,0);var u=a.ctx.getImageData(n.startX,n.startY,n.width,n.height);return new Promise(function(e){i.default.convertImage.toEl(u).then(function(r){var i=new CustomEvent(s.EventTypes.OnCropFinished,{detail:{image:r,selectBox:{pixels:n,percentages:t}}});o.canvas.el.dispatchEvent(i),e(r)})})}},draw:function(){var e=v.getSelectedArea(s.SelectBoxTypes.Pixels);o.canvas.clear(),o.canvas.ctx.putImageData(o.imageData,0,0),v.drawSelectBox(e),v.drawNegativeSelectBox(e)},drawSelectBox:function(e){o.canvas.ctx.beginPath(),o.canvas.ctx.strokeStyle="white",o.canvas.ctx.rect(e.startX,e.startY,e.width,e.height),o.canvas.ctx.stroke()},drawNegativeSelectBox:function(e){var t=o.canvas.ctx,n={top:{x:0,y:0,w:o.canvas.width,h:e.startY},bottom:{x:0,y:e.startY+e.height,w:o.canvas.width,h:o.canvas.height-e.startY+e.height},left:{x:0,y:e.startY,w:e.startX,h:e.height},right:{x:e.startX+e.width,y:e.startY,w:o.canvas.width-e.startX+e.width,h:e.height}};t.fillStyle="charcoal",t.globalAlpha=.8,Object.keys(n).forEach(function(e){var r=n[e];t.fillRect(r.x,r.y,r.w,r.h)}),t.globalAlpha=1},reset:function(){if(void 0!==o){v.setCursorStyle("default"),o.currentCoords=null,o.canvas.el.removeEventListener(a.MouseEvents.Mousedown,f.selectStart),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.selectMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseup,f.selectEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mousedown,f.selectResizeStart),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.selectResizeMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseup,f.selectResizeEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mousedown,f.dragStart),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.dragMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseup,f.dragEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.cursor),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.selectMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseenter,f.selectMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.selectResizeMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseenter,f.selectResizeMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.dragMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseenter,f.dragMove);var e=i.default.getUpdateResources(o.image.view.el,"pos");o.canvas.clear(),i.default.drawImage(o.canvas.el,o.image.view.el,e)}},getImageArea:function(){var e=o.image.view.pos;return{sx:e.dx,sy:e.dy,ex:e.dx+e.dWidth,ey:e.dy+e.dHeight}},adjustCoordsIfFlipped:function(){var e=o.currentCoords;if(e.sx>e.ex){var t=e.sx;e.sx=e.ex,e.ex=t}if(e.sy>e.ey){var n=e.sy;e.sy=e.ey,e.ey=n}},setMode:function(e){o.mode!==e&&("default"===e?o.mode=e:o.mode!==a.Mode.Resize&&o.mode!==a.Mode.Drag&&o.mode!==a.Mode.Select&&(o.mode=e))},updateCursor:function(e,t){var n=v.isNearSides(e,t);v.setCursorStyle(n)},isNearSides:function(e,t){var n=v.getSelectedArea(s.SelectBoxTypes.Pixels),r=n.startX,o=n.startY,i=n.startX+n.width,a=n.startY+n.height,u=Math.abs(e-r),c=Math.abs(t-o),l=Math.abs(e-i),f=Math.abs(t-a);if(u<10){if(c<10)return 0;if(f<10)return 3;if(t>o&&t<a)return 7}if(l<10){if(c<10)return 1;if(f<10)return 2;if(t>o&&t<a)return 5}return c<10&&e>r&&e<i?4:f<10&&e>r&&e<i?6:e>r+10&&e<i-10&&t>o+10&&t<a-10?8:null}},f={selectStart:function(e){var t=e.offsetX,n=e.offsetY;o.mode===a.Mode.Default&&v.setMode(a.Mode.Select);var r=o.image.view.pos;t>r.dx&&t<r.dx+r.dWidth&&n>r.dy&&n<r.dy+r.dHeight&&(v.calculateCoords(0,{x:t,y:n}),o.canvas.el.removeEventListener(a.MouseEvents.Mousedown,f.selectStart),o.canvas.el.addEventListener(a.MouseEvents.Mousemove,f.selectMove),o.canvas.el.addEventListener(a.MouseEvents.Mouseup,f.selectEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.selectMove),o.canvas.el.addEventListener(a.MouseEvents.Mouseenter,f.selectMove))},selectMove:function(e){var t=e.offsetX,n=e.offsetY;o.mode===a.Mode.Select&&v.calculateCoords(2,{x:t,y:n})&&v.draw()},selectEnd:function(){v.setMode(a.Mode.Default),v.adjustCoordsIfFlipped(),o.canvas.el.removeEventListener(a.MouseEvents.Mouseup,f.selectEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.selectMove),o.canvas.el.addEventListener(a.MouseEvents.Mousemove,f.cursor),o.canvas.el.addEventListener(a.MouseEvents.Mousedown,f.selectResizeStart),o.canvas.el.addEventListener(a.MouseEvents.Mousedown,f.dragStart),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.selectMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseenter,f.selectMove)},selectResizeStart:function(){8!==o.resizeCursorPosition&&(o.mode===a.Mode.Default&&v.setMode(a.Mode.Resize),o.canvas.el.addEventListener(a.MouseEvents.Mousemove,f.selectResizeMove),document.addEventListener(a.MouseEvents.Mouseup,f.selectResizeEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mousedown,f.selectResizeStart),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.cursor),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.selectResizeMove),o.canvas.el.addEventListener(a.MouseEvents.Mouseenter,f.selectResizeMove))},selectResizeMove:function(e){var t=e.offsetX,n=e.offsetY;o.mode===a.Mode.Resize&&v.calculateCoords(o.resizeCursorPosition,{x:t,y:n})&&v.draw()},selectResizeEnd:function(e){var t=e.offsetX,n=e.offsetY;o.canvas.el.removeEventListener(a.MouseEvents.Mouseup,f.selectResizeEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.selectResizeMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.selectResizeMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseenter,f.selectResizeMove),v.setMode(a.Mode.Default),v.adjustCoordsIfFlipped(),o.canvas.el.addEventListener(a.MouseEvents.Mousedown,f.selectResizeStart),o.canvas.el.addEventListener(a.MouseEvents.Mousemove,f.cursor),v.updateCursor(t,n)},dragStart:function(e){var t=e.offsetX,n=e.offsetY;8===o.resizeCursorPosition&&(o.mode===a.Mode.Default&&v.setMode(a.Mode.Drag),v.setDragMoveRefPoint({x:t,y:n}),o.canvas.el.addEventListener(a.MouseEvents.Mousemove,f.dragMove),document.addEventListener(a.MouseEvents.Mouseup,f.dragEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.dragMove),o.canvas.el.addEventListener(a.MouseEvents.Mouseenter,f.dragMove))},dragMove:function(e){var t=e.offsetX,n=e.offsetY;o.mode===a.Mode.Drag&&!0===v.calculateCoords(o.resizeCursorPosition,{x:t,y:n})&&v.draw()},dragEnd:function(e){var t=e.offsetX,n=e.offsetY;v.setMode(a.Mode.Default),v.setDragMoveRefPoint(null),o.canvas.el.removeEventListener(a.MouseEvents.Mousemove,f.dragMove),document.removeEventListener(a.MouseEvents.Mouseup,f.dragEnd),o.canvas.el.removeEventListener(a.MouseEvents.Mouseleave,f.dragMove),o.canvas.el.removeEventListener(a.MouseEvents.Mouseenter,f.dragMove),v.updateCursor(t,n)},cursor:function(e){var t=e.offsetX,n=e.offsetY;v.updateCursor(t,n)}},d=(c=function(){return{init:v.init,initSelect:v.initSelect,crop:v.crop,reset:v.reset}},{getInstance:function(){return u||(u=c()),u}});t.default=d.getInstance()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);var o,i,s=(i=function(){return{init:function(t,n){e=n},rotate:function(t,n){var o,i,s,a,u;void 0===t&&(t=null),o=null===t?e.view.el:t;var c=r.default.getAspectRatio(o);180===n||0===n?(c>=1?(i=o.width,s=o.height):(s=o.height,i=o.width),a=-i/2,u=-s/2):(c>=1?(s=o.width,i=o.height):(i=o.height,s=o.width),a=-s/2,u=-i/2);var l=r.default.createCanvas(i,s),v=l.ctx;v.save(),v.translate(i/2,s/2),v.rotate(n*Math.PI/180),v.drawImage(o,a,u),v.restore();var f=l.el.toDataURL(),d=r.default.createImage(f);return new Promise(function(e){d.init().then(function(t){t.el.width=i,t.el.height=s,e(t.el)})})},flip:function(t,n){void 0===t&&(t=e.view.el);var o=t||e.view.el,i=n.flipH,s=n.flipV,a=o.width,u=o.height,c=r.default.createCanvas(a,u),l=c.ctx,v=i?-1:1,f=s?-1:1,d=i?-1*a:0,h=s?-1*u:0;c.clear(),l.save(),l.scale(v,f),l.drawImage(o,d,h),l.restore();var g=c.el.toDataURL(),p=r.default.createImage(g);return new Promise(function(e){p.init().then(function(t){e(t.el)})})}};var e},{getInstance:function(){return o||(o=i()),o}});t.default=s.getInstance()},function(e,t,n){e.exports=n(7)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o,i,s,a,u,c,l,v,f,d=n(8),h=n(3),g=n(0),p=n(20),m=n(4),y=n(2),w=n(5);t.default=(r={canvas:null,image:null},o=function(e,t){if(void 0===e&&(e=r.image.src),void 0===t){var n=document.getElementsByClassName("editorCanvas")[0];n instanceof HTMLCanvasElement&&(t=n)}return m.default.reset(),d.default(e,t).then(function(e){return r.canvas=e.canvas,r.image=e.image,g.default.init(r.canvas),h.default.effects.init(r.canvas,r.image),h.default.transform.init(r.canvas,r.image),h.default.cropper.init(r.canvas,r.image),i(),Promise.resolve({canvas:r.canvas,image:r.image})})},i=function(e,t){void 0===e&&(e=r.image.el),void 0===t&&(t=!0);var n=function(e){var n=e.imageEl,o=e.imageData,i=e.pos;r.image.view.data=o,r.image.view.el=n,r.image.view.pos=i,!0===t&&(r.image.view.noEffects=n),r.canvas.clear(),g.default.drawImage(r.canvas.el,n,i)};e instanceof ImageData?g.default.convertImage.toEl(e).then(function(e){n(g.default.getUpdateResources(e))}):n(g.default.getUpdateResources(e))},s=function(e,t){void 0===e&&(e=r.image.view.data),void 0===t&&(t=null),null===t&&(t=g.default.operations.get([y.OpTypes.Brightness,y.OpTypes.Contrast])),a(e,t).then(function(e){null!==e&&i(e,!1)})},a=function(e,t){return new Promise(function(n){l(),n(h.default.effects.set(e,t))})},u=function(e,t,n){return new Promise(function(r){l(),r(h.default.transform[e](t,n)),w.default[e](t,n)})},c=function(e){!function(e){g.default.operations.save(y.OpTypes.Crop,e)}(e.detail.selectBox),v()},v=function(e,t){return void 0===e&&(e="imageElement"),void 0===t&&(t=r.image.el),l(),r.canvas.el.addEventListener(y.EventTypes.OnComposeFinished,f),p.default.init(t,e,r.canvas.el)},f=function(e){r.canvas.el.removeEventListener(y.EventTypes.OnComposeFinished,f),i(e.detail.image)},{init:o,reset:function(){return g.default.operations.reset(),l(),o()},setEffect:function(e,t){g.default.operations.save(e,+t),s(r.image.view.noEffects)},initCropSelect:function(){l(),h.default.cropper.initSelect(),r.canvas.el.addEventListener(y.EventTypes.OnCropFinished,c)},cancelCrop:l=function(){r.canvas.el.removeEventListener(y.EventTypes.OnCropFinished,c),m.default.reset()},crop:function(){h.default.cropper.crop()},flip:function(e,t){var n;return void 0===t&&(t=r.image.view.el),n=e,g.default.operations.save(y.OpTypes.Flip,n),Promise.resolve(u(y.OpTypes.Flip,t,e)).then(function(e){i(e)})},resize:function(e){var t,n,o=g.default.getAspectRatio(r.image.el),i=Number.isInteger(e.width),s=Number.isInteger(e.height);i?(n=s?e.height:e.width*o,t=e.width):s&&(t=e.height*o,n=e.height),g.default.operations.save(y.OpTypes.Resize,{width:t,height:n})},rotate:function(e,t){return void 0===t&&(t=r.image.view.el),function(e){g.default.operations.save(y.OpTypes.Rotate,e)}(e),Promise.resolve(u(y.OpTypes.Rotate,t,e)).then(function(e){i(e)})},compose:v,undo:function(){l(),g.default.operations.revert(),g.default.operations.get().length>0?(r.canvas.el.addEventListener(y.EventTypes.OnComposeFinished,function(e){i(e.detail.image)}),v()):i(r.image.el)},getOperations:function(){return g.default.operations.get()}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(1),i=function(e){return new o.CanvasObj(e)},s=function(e){var t=new r.ImageObj(e);return t.view.noEffects=void 0,new Promise(function(e){return t.init().then(function(t){e(t)})})};t.default=function(e,t){return n(15).polyfill(),Promise.all([i(t),s(e)]).then(function(e){var t=e[0],n=e[1];return Promise.resolve({canvas:t,image:n})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.calculateCenteredImagePosition=function(e,t){return function(e,t){var n=e.width,i=e.height,s=r.default.getAspectRatio(t),a=r.default.getAspectRatio(e),u=t.width,c=t.height,l=0,v=0,f=0,d=0;s>=a?t.width>=n?(f=n,l=0,v=o(e,"y",d=n/s)):(f=t.width,d=t.height,l=o(e,"x",f),v=o(e,"y",d)):t.height>=i?(d=i,l=o(e,"x",f=i*s),v=0):(f=t.width,d=t.height,l=o(e,"x",f),v=o(e,"y",d));return{sx:0,sy:0,sWidth:u,sHeight:c,dx:l,dWidth:f,dy:v,dHeight:d}}(e,t)};var o=function(e,t,n){return"x"===t?(e.width-n)/2:(e.height-n)/2}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function o(e){return.5*e}t.resizeImg=function(e,t){void 0===t&&(t={width:0,height:0});var n=e.width,i=e.height,s=t.width,a=t.height;return n===s||i===a?e:n>s&&i>a?function e(t,n){var i,s=o(t.width),a=o(t.height);if(s>n.width||a>n.height)return(i=r.default.createCanvas(s,a)).ctx.drawImage(t,0,0,i.width,i.height),e(i.el,n);i=r.default.createCanvas(n.width,n.height);var u=r.default.centerImage(i.el,t);return u.dx<u.dy?i.height=i.el.height=u.dHeight:i.width=i.el.width=u.dWidth,i.ctx.drawImage(t,0,0,i.width,i.height),i.el}(e,t):e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.convertImageType={toEl:function(e){return function(e){return new Promise(function(t){var n=r.default.createCanvas(e.width,e.height),o=n.el,i=n.ctx;i.putImageData(e,0,0);var s=new Image;s.onload=function(){t(s)},s.src=o.toDataURL(),s.width=e.width,s.height=e.height})}(e)},toData:function(e){return function(e){var t=r.default.createCanvas(e.width,e.height);return t.ctx.drawImage(e,0,0),t.ctx.getImageData(0,0,e.width,e.height)}(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawImg=function(e,t,n){return e.getContext("2d").drawImage(t,n.sx,n.sy,n.sWidth,n.sHeight,n.dx,n.dy,n.dWidth,n.dHeight),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(2);function i(){var e=[],t=function(t){var n=e.filter(function(e){return e.name===t});return 0===n.length?null:1===n.length?n[0]:n};return{save:function(t,n){if(t===o.OpTypes.Contrast||t===o.OpTypes.Brightness||t===o.OpTypes.Resize){var i=e.findIndex(function(e){return e.name===t});-1!==i&&e.splice(i,1)}e.push(new r.Operation(t,n))},reset:function(){e.length=0},revert:function(){e.length>0&&e.splice(-1,1)},get:function(n){if(void 0===n)return e.slice();if(Array.isArray(n))return r=[],n.forEach(function(e){var n=t(e);null!==n&&r.push(n)}),r;var r;if(n===o.OpTypes.Rotate){var i=t(n);return Array.isArray(i)?i.reduce(function(e,t){if("number"==typeof t.value)return e+t.value},0):i}return t(n)}}}var s,a={getInstance:function(){return s||(s=i()),s}};t.operationsService=a.getInstance()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.createUpdateResources=function(e,t,n){var o;return void 0===n&&(n=null),null===n?{imageEl:o=t.width!==e.width&&t.height!==e.height?r.default.resizeImage(t):t,imageData:r.default.convertImage.toData(o),pos:r.default.centerImage(e,o)}:"pos"===n?r.default.centerImage(e,t):void 0}},function(e,t,n){(function(t,n){
  /*!
   * @overview es6-promise - a tiny implementation of Promises/A+.
   * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
   * @license   Licensed under MIT license
   *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
   * @version   v4.2.5+7f2b526d
   */var r;r=function(){"use strict";function e(e){return"function"==typeof e}var r=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,i=void 0,s=void 0,a=function(e,t){h[o]=e,h[o+1]=t,2===(o+=2)&&(s?s(g):M())},u="undefined"!=typeof window?window:void 0,c=u||{},l=c.MutationObserver||c.WebKitMutationObserver,v="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(g,1)}}var h=new Array(1e3);function g(){for(var e=0;e<o;e+=2){(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0}o=0}var p,m,y,w,M=void 0;function E(e,t){var n=this,r=new this.constructor(_);void 0===r[x]&&F(r);var o=n._state;if(o){var i=arguments[o-1];a(function(){return B(o,r,i,n._result)})}else z(n,r,e,t);return r}function b(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(_);return R(t,e),t}v?M=function(){return t.nextTick(g)}:l?(m=0,y=new l(g),w=document.createTextNode(""),y.observe(w,{characterData:!0}),M=function(){w.data=m=++m%2}):f?((p=new MessageChannel).port1.onmessage=g,M=function(){return p.port2.postMessage(0)}):M=void 0===u?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(g)}:d()}catch(e){return d()}}():d();var x=Math.random().toString(36).substring(2);function _(){}var T=void 0,C=1,P=2,L={error:null};function I(e){try{return e.then}catch(e){return L.error=e,L}}function O(t,n,r){n.constructor===t.constructor&&r===E&&n.constructor.resolve===b?function(e,t){t._state===C?A(e,t._result):t._state===P?j(e,t._result):z(t,void 0,function(t){return R(e,t)},function(t){return j(e,t)})}(t,n):r===L?(j(t,L.error),L.error=null):void 0===r?A(t,n):e(r)?function(e,t,n){a(function(e){var r=!1,o=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?R(e,n):A(e,n))},function(t){r||(r=!0,j(e,t))},e._label);!r&&o&&(r=!0,j(e,o))},e)}(t,n,r):A(t,n)}function R(e,t){var n,r;e===t?j(e,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=t),null===n||"object"!==r&&"function"!==r?A(e,t):O(e,t,I(t)))}function S(e){e._onerror&&e._onerror(e._result),D(e)}function A(e,t){e._state===T&&(e._result=t,e._state=C,0!==e._subscribers.length&&a(D,e))}function j(e,t){e._state===T&&(e._state=P,e._result=t,a(S,e))}function z(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+C]=n,o[i+P]=r,0===i&&e._state&&a(D,e)}function D(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?B(n,r,o,i):o(i);e._subscribers.length=0}}function B(t,n,r,o){var i=e(r),s=void 0,a=void 0,u=void 0,c=void 0;if(i){if((s=function(e,t){try{return e(t)}catch(e){return L.error=e,L}}(r,o))===L?(c=!0,a=s.error,s.error=null):u=!0,n===s)return void j(n,new TypeError("A promises callback cannot return that same promise."))}else s=o,u=!0;n._state!==T||(i&&u?R(n,s):c?j(n,a):t===C?A(n,s):t===P&&j(n,s))}var Y=0;function F(e){e[x]=Y++,e._state=void 0,e._result=void 0,e._subscribers=[]}var X=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(_),this.promise[x]||F(this.promise),r(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?A(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&A(this.promise,this._result))):j(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===T&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===b){var o=I(e);if(o===E&&e._state!==T)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===N){var i=new n(_);O(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===T&&(this._remaining--,e===P?j(r,n):this._result[t]=n),0===this._remaining&&A(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;z(e,void 0,function(e){return n._settledAt(C,t,e)},function(e){return n._settledAt(P,t,e)})},e}(),N=function(){function t(e){this[x]=Y++,this._result=this._state=void 0,this._subscribers=[],_!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){R(e,t)},function(t){j(e,t)})}catch(t){j(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this.constructor;return e(t)?this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):this.then(t,t)},t}();return N.prototype.then=E,N.all=function(e){return new X(this,e).promise},N.race=function(e){var t=this;return r(e)?new t(function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},N.resolve=b,N.reject=function(e){var t=new this(_);return j(t,e),t},N._setScheduler=function(e){s=e},N._setAsap=function(e){a=e},N._asap=a,N.polyfill=function(){var e=void 0;if(void 0!==n)e=n;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=N},N.Promise=N,N},e.exports=r()}).call(this,n(16),n(17))},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var u,c=[],l=!1,v=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):v=-1,c.length&&d())}function d(){if(!l){var e=a(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++v<t;)u&&u[v].run();v=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||a(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r,o,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Default="default",e.Select="select",e.Resize="resize",e.Drag="drag"}(t.Mode||(t.Mode={})),function(e){e.Mouseup="mouseup",e.Mousedown="mousedown",e.Mousemove="mousemove",e.Mouseenter="mouseenter",e.Mouseleave="mouseleave"}(t.MouseEvents||(t.MouseEvents={})),function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomRight=2]="BottomRight",e[e.BottomLeft=3]="BottomLeft",e[e.Top=4]="Top",e[e.Right=5]="Right",e[e.Bottom=6]="Bottom",e[e.Left=7]="Left",e[e.All=8]="All"}(i=t.Corners||(t.Corners={})),t.cornerMap=((r={})[i.TopLeft]=["sx","sy"],r[i.TopRight]=["ex","sy"],r[i.BottomRight]=["ex","ey"],r[i.BottomLeft]=["sx","ey"],r[i.Top]=["sy"],r[i.Right]=["ex"],r[i.Bottom]=["ey"],r[i.Left]=["sx"],r[i.All]=["sx","ex","sy","ey"],r),t.cursorStyleValues=((o={})[i.TopLeft]="nwse-resize",o[i.TopRight]="nesw-resize",o[i.BottomRight]="nwse-resize",o[i.BottomLeft]="nesw-resize",o[i.Top]="ns-resize",o[i.Right]="ew-resize",o[i.Bottom]="ns-resize",o[i.Left]="ew-resize",o[i.All]="move",o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);var o,i,s=(i=function(){return e=null,t={brightness:function(e,t){var n=e*t;return n>255?255:n<0?0:n},contrast:function(e,t){var n=e*t+128*(1-t);return n>255?255:n<0?0:n}},n=function(e,t,n){var r={r:void 0,g:void 0,b:void 0};if(n.length>1)n.forEach(function(n){r.r=void 0===r.r?e[t]:r.r,r.g=void 0===r.g?e[t+1]:r.g,r.b=void 0===r.b?e[t+2]:r.b,o(r,n)});else{var i=n[0];r.r=void 0===r.r?e[t]:r.r,r.g=void 0===r.g?e[t+1]:r.g,r.b=void 0===r.b?e[t+2]:r.b,o(r,i)}return r},o=function(e,n){var r=n.name,o=n.value;e.r=t[r](e.r,o),e.g=t[r](e.g,o),e.b=t[r](e.b,o)},i=function(e,t){var o=e.data,i=new ArrayBuffer(o.length),s=new Uint8ClampedArray(i),a=new Uint32Array(i),u=function(e,t,n){return e<<24|t<<16|n<<8|255},c=function(e,t,n){return 255<<24|n<<16|t<<8|e},l=0;if(function(e){return!(10===e[4]&&11===e[5]&&12===e[6]&&13===e[7])}(i))for(var v=0;v<o.length;v+=4){var f=n(o,v,t),d=f.r,h=f.g,g=f.b;a[l]=c(d,h,g),l++}else for(v=0;v<o.length;v+=4){var p=n(o,v,t);d=p.r,h=p.g,g=p.b,a[l]=u(d,h,g),l++}return o.set(s),new Promise(function(t){Promise.resolve(r.default.convertImage.toEl(e)).then(function(e){t(e)})})},{init:function(t,n){e=n},set:function(t,n){return void 0===t&&(t=e.view.data),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(t=r.default.convertImage.toData(t)),i(t,n)}};var e,t,n,o,i},{getInstance:function(){return o||(o=i()),o}});t.default=s.getInstance()},function(e,t,n){"use strict";var r=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=n(3),s=n(2);function a(){var e,t,n,a,u,c=function(){e=void 0,t=void 0,n=void 0,a=void 0,u=void 0};function l(e){var t=new CustomEvent(s.EventTypes.OnComposeFinished,{detail:{image:e}});u.dispatchEvent(t),c()}var v=function(){var e=o.default.operations.get(),n=[],r=!1;return e.forEach(function(e){e.name===s.OpTypes.Brightness||e.name===s.OpTypes.Contrast&&!1===r?r=!0:e.name===s.OpTypes.Crop?n.push(function(){return n=e.value.percentages,Promise.resolve(i.default.cropper.crop(t,n));var n}):e.name===s.OpTypes.Flip?n.push(function(){return n=e.value,Promise.resolve(i.default.transform.flip(t,n));var n}):e.name===s.OpTypes.Rotate?n.push(function(){return n=e.value,Promise.resolve(i.default.transform.rotate(t,n));var n}):e.name===s.OpTypes.Resize&&n.push(function(){return n=e.value,t.width=n.width,t.height=n.height,new Promise(function(e){var r=o.default.createCanvas(n.width,n.height);r.ctx.drawImage(t,0,0,n.width,n.height),e(r.el)});var n})}),r&&n.push(f),n};function f(){var e=o.default.operations.get([s.OpTypes.Brightness,s.OpTypes.Contrast]);return Promise.resolve(i.default.effects.set(t,e))}return{init:function(i,s,c){if(t=i,a=s,u=c,!(n=v()).length)return i;(e=function(){var i,s;return r(this,function(r){switch(r.label){case 0:i=n,s=0,r.label=1;case 1:return s<i.length?(i[s]().then(function(n){t=n;var r=e.next();if(r.done)if("imageElement"===a)l(t);else if("image/jpeg"===a){var i=o.default.createCanvas(t.width,t.height);i.ctx.drawImage(t,0,0);var s=i.el.toDataURL("image/jpeg");return void l(s)}}),[4,s]):[3,3];case 2:return r.sent(),s++,[3,1];case 3:return[2]}})}()).next()}}}var u,c={getInstance:function(){return u||(u=a()),u}};t.default=c.getInstance()}]);
